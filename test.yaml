# æœºåœºèŠ‚ç‚¹è®¢é˜…

proxy-providers:

  æœºåœº1:
    url: "æœºåœºè®¢é˜…åœ°å€"  
    type: http
    interval: 86400
    health-check:
      enable: true
      url: https://www.gstatic.com/generate_204
      interval: 300
    proxy: ç›´è¿
    override:
      ip-version: ipv6-prefer
      additional-suffix: "| æœºåœº1"

  æœºåœº2:
    url: "æœºåœºè®¢é˜…åœ°å€"  
    type: http
    interval: 86400
    health-check:
      enable: true
      url: https://www.gstatic.com/generate_204
      interval: 300
    proxy: ç›´è¿
    override:
      ip-version: ipv6-prefer
      additional-suffix: "| æœºåœº2"

proxies:
  - {name: ç›´è¿, type: direct}
  - {name: æ‹’ç», type: reject}

# ========================
# ä¸»è¦ç«¯å£è®¾ç½®
# ========================
port: 7890
socks-port: 7891
redir-port: 7892
mixed-port: 7893
tproxy-port: 7895

allow-lan: true
mode: rule
log-level: info

external-controller: 0.0.0.0:9090
# external-ui: ui
# external-ui-name: zashboard
# external-ui-url: https://gh-proxy.com/github.com/Zephyruso/zashboard/archive/refs/heads/gh-pages.zip
secret: "123456"

# ========================
# DNS è®¾ç½®
# ========================
dns:
  enable: true
  listen: 0.0.0.0:7874
  ipv6: true
  enhanced-mode: fake-ip
  fake-ip-range: 198.20.0.1/16
  nameserver:
    - 223.5.5.5
  fake-ip-filter-mode: blacklist
  fake-ip-filter:
    - +.lan
    - +.local
    - geosite:cn

    # æœ¬åœ°ç½‘ç»œå’Œæµ‹è¯•åŸŸå
    - '*.lan'
    - '*.local'
    - '*.localhost'
    - '*.home.arpa'
    - '*.localdomain'
    - '*.example'
    - '*.invalid'
    - '*.test'
    # ç³»ç»Ÿæ£€æµ‹å’Œæ—¶é—´æœåŠ¡
    - '+.msftconnecttest.com'  # Windows è¿æ¥æ£€æµ‹
    - '+.msftncsi.com'         # Windows è¿æ¥æ£€æµ‹
    - 'time.*.com'             # æ—¶é—´åŒæ­¥æœåŠ¡
    - 'time.*.edu.cn'          # å›½å†…æ—¶é—´æœåŠ¡
    - 'time.*.apple.com'       # è‹¹æœæ—¶é—´æœåŠ¡
    - '+.pool.ntp.org'         # NTP æœåŠ¡

# ========================
# TUN æ¨¡å—
# ========================
tun:
  enable: true
  stack: gvisor
  device: utun
  endpoint-independent-nat: true
  auto-route: false
  auto-detect-interface: false
  auto-redirect: false
  strict-route: false

profile:
  store-selected: true
  store-fake-ip: true
 

# ========================
# ç­–ç•¥ç»„å®šä¹‰
# ========================

pr: &pr {type: select, proxies: [â™»ï¸ é¦™æ¸¯è‡ªåŠ¨, â™»ï¸ æ—¥æœ¬è‡ªåŠ¨, â™»ï¸ ç¾å›½è‡ªåŠ¨, â™»ï¸ æ–°åŠ å¡è‡ªåŠ¨, â™»ï¸ å°æ¹¾è‡ªåŠ¨, â™»ï¸ è‡ªåŠ¨é€‰æ‹©, ğŸŒ å…¨éƒ¨èŠ‚ç‚¹, â˜‘ï¸ æœºåœºåˆ‡æ¢, â™»ï¸ ä¼˜é€‰è‡ªåŠ¨, ğŸ”® ä¼˜é€‰å‡è¡¡, ç›´è¿, æ‹’ç»]}
proxy-groups:
  - {name: å¹¿å‘Š, <<: *pr}
  - {name: Cloudflare, <<: *pr}
  - {name: å›½å¤–, <<: *pr}
  - {name: å›½å†…, <<: *pr}
  - {name: Games, <<: *pr}
  - {name: AI, <<: *pr}
  - {name: Test, <<: *pr}
  - {name: Apple, <<: *pr}
  - {name: Microsoft, <<: *pr}
  - {name: å…¶ä»–, <<: *pr}

  - {name: ğŸ”® ä¼˜é€‰å‡è¡¡, type: load-balance, include-all: true, filter: "(?i)æœºåœº2"}
  - {name: â™»ï¸ ä¼˜é€‰è‡ªåŠ¨, type: url-test, include-all: true, filter: "(?i)æœºåœº2"}

  - {name: â˜‘ï¸ æœºåœºåˆ‡æ¢, type: select, include-all: true, filter: "(?i)æœºåœº1"}

  - {name: â™»ï¸ é¦™æ¸¯è‡ªåŠ¨, type: url-test, include-all: true, tolerance: 20, interval: 300, filter: "(?=.*(å¹¿æ¸¯|é¦™æ¸¯|HK|Hong Kong|ğŸ‡­ğŸ‡°|HongKong)).*$"}
  - {name: â™»ï¸ æ—¥æœ¬è‡ªåŠ¨, type: url-test, include-all: true, tolerance: 20, interval: 300, filter: "(?=.*(æ—¥æœ¬|JP|Japan|ğŸ‡¯ğŸ‡µ|Japan)).*$"}
  - {name: â™»ï¸ ç¾å›½è‡ªåŠ¨, type: url-test, include-all: true, tolerance: 20, interval: 300, filter: "(?=.*(ç¾å›½|US|United States|ğŸ‡ºğŸ‡¸|United States)).*$"}
  - {name: â™»ï¸ æ–°åŠ å¡è‡ªåŠ¨, type: url-test, include-all: true, tolerance: 20, interval: 300, filter: "(?=.*(æ–°åŠ å¡|SG|Singapore|ğŸ‡¸ğŸ‡¬|Singapore)).*$"}
  - {name: â™»ï¸ å°æ¹¾è‡ªåŠ¨, type: url-test, include-all: true, tolerance: 20, interval: 300, filter: "(?=.*(å°æ¹¾|TW|Taiwan|ğŸ‡¹ğŸ‡¼|Taiwan)).*$"}

  - {name: â™»ï¸ è‡ªåŠ¨é€‰æ‹©, type: url-test, include-all: true, tolerance: 20, interval: 300, filter: "^((?!(å›½å†…)).)*$"}
  - {name: ğŸŒ å…¨éƒ¨èŠ‚ç‚¹, type: select, include-all: true}

# ========================
# è§„åˆ™å¼•æ“ï¼ˆrulesï¼‰
# ========================
rules:
  # å±€åŸŸç½‘ç›´è¿
  - IP-CIDR,0.0.0.0/8,DIRECT
  - IP-CIDR,10.0.0.0/8,DIRECT
  - IP-CIDR,100.64.0.0/10,DIRECT
  - IP-CIDR,127.0.0.0/8,DIRECT
  - IP-CIDR,169.254.0.0/16,DIRECT
  - IP-CIDR,172.16.0.0/12,DIRECT
  - IP-CIDR,192.0.0.0/24,DIRECT
  - IP-CIDR,192.0.2.0/24,DIRECT
  - IP-CIDR,192.88.99.0/24,DIRECT
  - IP-CIDR,192.168.0.0/16,DIRECT
  - IP-CIDR,198.18.0.0/15,DIRECT
  - IP-CIDR,198.51.100.0/24,DIRECT
  - IP-CIDR,203.0.113.0/24,DIRECT
  - IP-CIDR,224.0.0.0/3,DIRECT
  - IP-CIDR6,::/127,DIRECT
  - IP-CIDR6,fc00::/7,DIRECT
  - IP-CIDR6,fe80::/10,DIRECT
  - IP-CIDR6,ff00::/8,DIRECT

  - RULE-SET,TEST,Test
  - RULE-SET,AI,AI
  - RULE-SET,Microsoft,Microsoft
  - RULE-SET,Apple,Apple
  - RULE-SET,Apple-CN,Apple
  - RULE-SET,Apple-Custome,Apple
  - RULE-SET,Games,Games

  - RULE-SET,Advertising,å¹¿å‘Š
  - RULE-SET,sr_ad_only,å¹¿å‘Š
  - RULE-SET,å¹¿å‘Š,å¹¿å‘Š
  - RULE-SET,ad,å¹¿å‘Š

  - RULE-SET,DIY_direct,å›½å†…
  - RULE-SET,CloudflareIP,Cloudflare,no-resolve
  - RULE-SET,Global,å›½å¤–
  - RULE-SET,China,å›½å†…
  - RULE-SET,ChinaIP,å›½å†…,no-resolve
  - RULE-SET,Private,å›½å†…
  - MATCH,å…¶ä»–

# ========================
# è§„åˆ™é›†æä¾›è€…
# ========================
rule-anchor:
  ip: &ip {type: http, interval: 86400, behavior: ipcidr, format: mrs}
  domain: &domain {type: http, interval: 86400, behavior: domain, format: mrs}
  class: &class {type: http, interval: 86400, behavior: classical, format: text}
  iptxt: &iptxt {type: http, interval: 86400, behavior: ipcidr, format: text}

rule-providers:
  TEST: {<<: *class, url: "https://gh-proxy.com/raw.githubusercontent.com/liandu2024/clash/refs/heads/main/list/Check.list"}
  GitHub: {<<: *domain, url: "https://gh-proxy.com/github.com/metacubex/meta-rules-dat/raw/refs/heads/meta/geo/geosite/github.mrs"}
  Apple-CN: {<<: *domain, url: "https://gh-proxy.com/github.com/metacubex/meta-rules-dat/raw/refs/heads/meta/geo/geosite/apple-cn.mrs"}
  Apple: {<<: *domain, url: "https://gh-proxy.com/github.com/metacubex/meta-rules-dat/raw/refs/heads/meta/geo/geosite/apple.mrs"} 
  Apple-Custome: {<<: *class, url: "https://gh-proxy.com/raw.githubusercontent.com/liandu2024/clash/refs/heads/main/list/Apple.list"}
  Microsoft: {<<: *domain, url: "https://gh-proxy.com/github.com/metacubex/meta-rules-dat/raw/refs/heads/meta/geo/geosite/microsoft.mrs"}
  CloudflareIP: {<<: *iptxt, url: "https://gh-proxy.com/raw.githubusercontent.com/GuangYu-yu/ACL4SSR/refs/heads/main/Clash/Cloudflare.txt"}
  Global: {<<: *class, url: "https://gh-proxy.com/raw.githubusercontent.com/blackmatrix7/ios_rule_script/refs/heads/master/rule/Clash/Global/Global.list"} 
  Private: {<<: *domain, url: "https://gh-proxy.com/github.com/metacubex/meta-rules-dat/raw/refs/heads/meta/geo/geosite/private.mrs"}
  China: {<<: *domain, url: "https://gh-proxy.com/github.com/metacubex/meta-rules-dat/raw/refs/heads/meta/geo/geosite/cn.mrs"}
  ChinaIP: {<<: *ip, url: "https://gh-proxy.com/github.com/metacubex/meta-rules-dat/raw/refs/heads/meta/geo/geoip/cn.mrs"}
  AI: {  <<: *domain, url: "https://raw.githubusercontent.com/MetaCubeX/meta-rules-dat/refs/heads/meta/geo/geosite/category-ai-!cn.mrs" }
  GlobalMedia: { <<: *class, url: "https://raw.githubusercontent.com/blackmatrix7/ios_rule_script/master/rule/Clash/GlobalMedia/GlobalMedia.list"}
  Games: { <<: *class, url: "https://raw.githubusercontent.com/blackmatrix7/ios_rule_script/refs/heads/master/rule/Clash/Game/Game.list"}
  DIY_direct: { <<: *class, url: "https://cdn.jsdelivr.net/gh/GuangYu-yu/ACL4SSR/direct.list"}

  Advertising: { <<: *class, url: "https://raw.githubusercontent.com/blackmatrix7/ios_rule_script/refs/heads/master/rule/Clash/Advertising/Advertising.list"}
  sr_ad_only: { <<: *class, url: "https://johnshall.github.io/Shadowrocket-ADBlock-Rules-Forever/sr_ad_only.conf"}
  å¹¿å‘Š: { <<: *domain, url: "https://raw.githubusercontent.com/GuangYu-yu/AdBlock_Rule_For_Clash/refs/heads/main/adblock_reject.mrs"}
  ad: { <<: *class, url: "https://raw.githubusercontent.com/LM-Firefly/Rules/refs/heads/master/Adblock/Adblock.list"}

# OpenClash è®¾ç½®
bind-address: "*"
external-ui: "/usr/share/openclash/ui"
external-ui-name: metacubexd
keep-alive-interval: 15
keep-alive-idle: 600
tcp-concurrent: true
unified-delay: true
geox-url:
  mmdb: https://testingcf.jsdelivr.net/gh/alecthw/mmdb_china_ip_list@release/lite/Country.mmdb
  geosite: https://testingcf.jsdelivr.net/gh/Loyalsoldier/v2ray-rules-dat@release/geosite.dat
  asn: https://testingcf.jsdelivr.net/gh/xishang0128/geoip@release/GeoLite2-ASN.mmdb
sniffer:
  enable: true
  override-destination: true
  sniff:
    QUIC:
      ports:
      - 443
    TLS:
      ports:
      - 443
      - 8443
    HTTP:
      ports:
      - 80
      - 8080-8880
      override-destination: true
  force-domain:
  - "+.netflix.com"
  - "+.nflxvideo.net"
  - "+.amazonaws.com"
  - "+.media.dssott.com"
  skip-domain:
  - "+.apple.com"
  - Mijia Cloud
  - dlg.io.mi.com
  - "+.oray.com"
  - "+.sunlogin.net"
  - "+.push.apple.com"
  parse-pure-ip: true
